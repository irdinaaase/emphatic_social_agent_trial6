<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mickey's Learning Hub - Settings</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&family=Fredoka+One&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@open-dyslexic/open-dyslexic@1.0.3/css/open-dyslexic.css">
    
    <style>
        :root {
            /* Default Mickey theme */
            --mickey-red: #ffe3e2;
            --mickey-yellow: #f19d3b;
            --mickey-black: #25221a;
            --mickey-white: #e9e7db;
            --mickey-blue: #8ac6d1;
            --mickey-pink: #ffb8c6;
            --mickey-green: #95e1d3;
            --mickey-purple: #ded8e4;
            --mickey-bg: #010101;
            
            /* IRLEN Color Schemes */
            --irlen-cream: #fffef0;
            --irlen-blue: #e6f3ff;
            --irlen-green: #f0fff0;
            --irlen-pink: #fff0f5;
            --irlen-gray: #f5f5f5;
            --irlen-purple: #f5f0ff;
            --irlen-yellow: #fffff0;
            --irlen-rose: #fff0f0;
        }

        /* ============================================
           DYSLEXIA MODE (FOLLOW PROFILE)
           ============================================ */
        body.dyslexia-mode {
            font-family: 'OpenDyslexic', 'Comic Sans MS', sans-serif !important;
            letter-spacing: 0.1em;
            line-height: 1.8;
            background: var(--irlen-cream) !important;
            color: #333333;
        }

        /* ============================================
           DEFAULT BODY (NO DYSLEXIA MODE)
           ============================================ */
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Fredoka One', cursive;
            background: linear-gradient(135deg, var(--mickey-bg) 0%, #ffe6e6 100%);
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.8) 2px, transparent 2px),
                radial-gradient(circle at 90% 80%, rgba(255, 255, 255, 0.8) 2px, transparent 2px);
            background-size: 40px 40px;
            transition: all 0.3s ease;
        }

        /* ============================================
           IRLEN COLOR SCHEMES (FOLLOW PROFILE)
           ============================================ */
        body.irlen-cream {
            background: var(--irlen-cream) !important;
            color: #333333;
        }

        body.irlen-blue {
            background: var(--irlen-blue) !important;
            color: #003366;
        }

        body.irlen-green {
            background: var(--irlen-green) !important;
            color: #006600;
        }

        body.irlen-pink {
            background: var(--irlen-pink) !important;
            color: #660033;
        }

        body.irlen-gray {
            background: var(--irlen-gray) !important;
            color: #333333;
        }

        body.irlen-purple {
            background: var(--irlen-purple) !important;
            color: #330066;
        }

        body.irlen-yellow {
            background: var(--irlen-yellow) !important;
            color: #663300;
        }

        body.irlen-rose {
            background: var(--irlen-rose) !important;
            color: #660000;
        }

        /* Apply Irlen colors to dyslexia mode as well */
        body.dyslexia-mode.irlen-cream {
            background: var(--irlen-cream) !important;
            color: #333333;
        }
        body.dyslexia-mode.irlen-blue {
            background: var(--irlen-blue) !important;
            color: #003366;
        }
        body.dyslexia-mode.irlen-green {
            background: var(--irlen-green) !important;
            color: #006600;
        }

        /* ============================================
           COMMON ELEMENTS STYLES (FOLLOW PROFILE THEME)
           ============================================ */
        .fixed-header {
            top: 35px;
            left: 0;
            width: 100%;
            z-index: 9999;
            padding: 15px 20px;
            backdrop-filter: blur(10px);
        }

        .header-container {
            display: flex;
            justify-content: center;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .header-nav {
            display: flex;
            gap: 10px;
        }

        .nav-tab {
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.8);
            color: inherit;
            border: 2px solid currentColor;
            border-radius: 15px;
            font-family: inherit;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: rgba(138, 198, 209, 0.8);
            color: #333333;
        }

        .settings-content {
        padding: 30px;
            border-radius: 25px;
            box-shadow: 0 10px 0 currentColor;
            margin-top: 20px;
            max-width: 1400px;
            margin: 20px auto;
            background: rgba(255, 255, 255, 0.95) !important;
    border: 3px solid currentColor !important;
    color: inherit !important;
        }
        
        .setting-section {
            background: rgba(233, 169, 70, 0.1);
            padding: 20px;
            border-radius: 15px;
            border: 3px solid currentColor;
            margin-bottom: 20px;
            color: inherit;
        }

        .setting-btn {
            padding: 12px 20px;
            background: var(--mickey-blue);
            color: white;
            border: 3px solid currentColor;
            border-radius: 15px;
            font-family: inherit;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin-top: 15px;
        }

        .setting-btn:hover {
            background: var(--mickey-pink);
            transform: translateY(-3px);
            box-shadow: 0 5px 0 currentColor;
        }

        /* IRLEN Color Selector in Settings */
        .irlen-selector-settings {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .irlen-btn-settings {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid currentColor;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }

        .irlen-btn-settings:hover {
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        .irlen-btn-settings.active {
            border: 3px solid #ffffff;
            box-shadow: 0 0 0 2px currentColor;
        }

        .irlen-label {
            font-size: 0.8rem;
            text-align: center;
            margin-top: 5px;
            color: currentColor;
        }

        /* ============================================
           NOTIFICATIONS
           ============================================ */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            color: currentColor;
            padding: 15px 20px;
            border-radius: 15px;
            border: 2px solid currentColor;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 10000;
            max-width: 300px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }

        /* ============================================
           RESPONSIVE DESIGN
           ============================================ */
        @media (max-width: 768px) {
            body {
                padding-top: 160px;
            }
            
            .fixed-header {
                padding: 10px;
            }
            
            .header-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .header-nav {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .nav-tab {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            .settings-content {
                margin: 20px 10px;
                padding: 20px;
            }
            
            .irlen-selector-settings {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Text styles that follow dyslexia mode */
        .dyslexia-text {
            font-family: inherit;
        }
    </style>
</head>
<body>
    <header class="fixed-header">
        <div class="header-container">
            <nav class="header-nav">
                <a href="game-center.html" class="nav-tab">
                    <i class="fas fa-gamepad"></i>
                </a>
                <a href="profile.html" class="nav-tab">
                    <i class="fas fa-user"></i>
                </a>
                <a href="settings.html" class="nav-tab active">
                    <i class="fas fa-cog"></i>
                </a>
            </nav>
        </div>
    </header>

    <div class="settings-content">
        <h2 style="color: currentColor; text-align: center; margin-bottom: 30px;">
            <i class="fas fa-cog"></i> Settings & Preferences
        </h2>
        
        <!-- Accessibility Settings Section -->
        <div class="setting-section">
            <h3 style="color: currentColor; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-book-reader"></i> Accessibility Settings
            </h3>
            <p style="color: currentColor; font-family: inherit; margin-bottom: 15px;">
                Toggle dyslexia-friendly font and spacing
            </p>
            
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                <div style="font-size: 1.2rem; color: currentColor;">
                    <i class="fas fa-font"></i>
                </div>
                <div style="flex: 1;">
                    <div style="color: currentColor; font-weight: bold;">Dyslexia-Friendly Mode</div>
                    <div style="color: currentColor; font-size: 0.9rem; opacity: 0.8;">
                    Uses OpenDyslexic font with increased letter spacing
                    </div>
                </div>
                <button class="setting-btn" id="toggle-dyslexia" style="width: auto; padding: 10px 20px;">
                    <span id="dyslexia-status">Standard Font Mode (ON)</span>
                </button>
            </div>
        </div>
        
        <!-- Visual Stress (Irlen) Settings Section -->
        <div class="setting-section">
            <h3 style="color: currentColor; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-palette"></i> Visual Stress Colors
            </h3>
            <p style="color: currentColor; font-family: inherit; margin-bottom: 15px;">
                Choose a color scheme to reduce visual stress (Irlen Syndrome support)
            </p>
            
            <div class="irlen-selector-settings">
                <div>
                    <div class="irlen-btn-settings" style="background: var(--mickey-bg);" data-scheme="default" title="Default">
                        <i class="fas fa-mouse" style="color: white; font-size: 1.2rem;"></i>
                    </div>
                    <div class="irlen-label">Default</div>
                </div>
                <div>
                    <div class="irlen-btn-settings" style="background: var(--irlen-cream);" data-scheme="irlen-cream" title="Cream"></div>
                    <div class="irlen-label">Cream</div>
                </div>
                <div>
                    <div class="irlen-btn-settings" style="background: var(--irlen-blue);" data-scheme="irlen-blue" title="Blue"></div>
                    <div class="irlen-label">Blue</div>
                </div>
                <div>
                    <div class="irlen-btn-settings" style="background: var(--irlen-green);" data-scheme="irlen-green" title="Green"></div>
                    <div class="irlen-label">Green</div>
                </div>
                <div>
                    <div class="irlen-btn-settings" style="background: var(--irlen-pink);" data-scheme="irlen-pink" title="Pink"></div>
                    <div class="irlen-label">Pink</div>
                </div>
                <div>
                    <div class="irlen-btn-settings" style="background: var(--irlen-gray);" data-scheme="irlen-gray" title="Gray"></div>
                    <div class="irlen-label">Gray</div>
                </div>
                <div>
                    <div class="irlen-btn-settings" style="background: var(--irlen-purple);" data-scheme="irlen-purple" title="Purple"></div>
                    <div class="irlen-label">Purple</div>
                </div>
                <div>
                    <div class="irlen-btn-settings" style="background: var(--irlen-yellow);" data-scheme="irlen-yellow" title="Yellow"></div>
                    <div class="irlen-label">Yellow</div>
                </div>
                <div>
                    <div class="irlen-btn-settings" style="background: var(--irlen-rose);" data-scheme="irlen-rose" title="Rose"></div>
                    <div class="irlen-label">Rose</div>
                </div>
            </div>
        </div>
        
        <div class="setting-section">
            <h3 style="color: currentColor; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-volume-up"></i> Sound Settings
            </h3>
            <p style="color: currentColor; font-family: inherit; margin-bottom: 15px;">
                Enable or disable voice guidance and sound effects
            </p>
            <button class="setting-btn" id="toggle-sound">
                <i class="fas fa-volume-up"></i> Toggle Sound
            </button>
        </div>
        
        <div class="setting-section">
            <h3 style="color: currentColor; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-user-edit"></i> Account Settings
            </h3>
            <p style="color: currentColor; font-family: inherit; margin-bottom: 15px;">
                Manage your student profile
            </p>
            <button class="setting-btn" onclick="changeStudentName()">
                <i class="fas fa-edit"></i> Change Student Name
            </button>
        </div>
        
        <div class="setting-section">
            <h3 style="color: currentColor; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-database"></i> Data Management
            </h3>
            <p style="color: currentColor; font-family: inherit; margin-bottom: 15px;">
                Manage your saved progress and data
            </p>
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="setting-btn" onclick="exportProgress()">
                    <i class="fas fa-download"></i> Export Progress
                </button>
                <button class="setting-btn" onclick="resetProgress()">
                    <i class="fas fa-redo"></i> Reset Progress
                </button>
            </div>
        </div>
        
        <div class="setting-section">
            <h3 style="color: currentColor; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-sign-out-alt"></i> Logout
            </h3>
            <p style="color: currentColor; font-family: inherit; margin-bottom: 15px;">
                Clear your data and return to welcome screen
            </p>
            <button class="setting-btn" onclick="logout()" style="background: var(--mickey-black); color: white;">
                <i class="fas fa-sign-out-alt"></i> Logout & Clear Data
            </button>
        </div>
    </div>

    <script>
        // ============================================
        // APPLY SETTINGS FROM LOCALSTORAGE (FOLLOW PROFILE)
        // ============================================
        function applySavedSettings() {
            // Apply dyslexia mode
            const dyslexiaEnabled = localStorage.getItem('dyslexiaMode') === 'true';
            if (dyslexiaEnabled) {
                document.body.classList.add('dyslexia-mode');
            }
            
            // Apply Irlen color scheme
            const irlenScheme = localStorage.getItem('irlenScheme') || 'default';
            if (irlenScheme !== 'default') {
                document.body.classList.add(irlenScheme);
            }
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        window.addEventListener('load', function() {
            const savedName = localStorage.getItem('studentName');
            if (!savedName) {
                window.location.href = 'welcome.html';
                return;
            }
            
            // Apply saved settings from localStorage (IMPORTANT!)
            applySavedSettings();
            
            // Initialize dyslexia mode toggle
            initializeDyslexiaToggle();
            
            // Initialize Irlen color scheme selector
            initializeIrlenSelector();
            
            // Initialize sound toggle
            initializeSoundToggle();
            
            console.log('⚙️ Settings loaded with profile theme');
        });

        function initializeDyslexiaToggle() {
            const dyslexiaBtn = document.getElementById('toggle-dyslexia');
            const dyslexiaMode = localStorage.getItem('dyslexiaMode');
            
            // Default is dyslexia mode (true), so we show "Standard Font Mode" button
            if (dyslexiaMode === 'false') {
                dyslexiaBtn.innerHTML = '<i class="fas fa-toggle-off"></i> Dyslexia Mode (OFF)';
            } else {
                // Dyslexia mode is ON by default
                localStorage.setItem('dyslexiaMode', 'true');
                dyslexiaBtn.innerHTML = '<i class="fas fa-toggle-on"></i> Standard Font Mode (ON)';
            }
            
            dyslexiaBtn.addEventListener('click', function() {
                const isDyslexiaMode = localStorage.getItem('dyslexiaMode') === 'true';
                
                if (isDyslexiaMode) {
                    // Currently in dyslexia mode, switch to standard
                    document.body.classList.remove('dyslexia-mode');
                    localStorage.setItem('dyslexiaMode', 'false');
                    this.innerHTML = '<i class="fas fa-toggle-off"></i> Dyslexia Mode (OFF)';
                    showSettingsNotification('Dyslexia-friendly fonts disabled. Using standard fonts.');
                } else {
                    // Currently in standard mode, switch to dyslexia
                    document.body.classList.add('dyslexia-mode');
                    localStorage.setItem('dyslexiaMode', 'true');
                    this.innerHTML = '<i class="fas fa-toggle-on"></i> Standard Font Mode (ON)';
                    showSettingsNotification('Dyslexia-friendly fonts enabled!');
                }
                
                // Update the button text
                const statusElement = document.getElementById('dyslexia-status');
                if (statusElement) {
                    statusElement.innerHTML = this.innerHTML;
                }
            });
        }

        function initializeIrlenSelector() {
            // Load Irlen color scheme
            const irlenScheme = localStorage.getItem('irlenScheme') || 'default';
            
            // Apply scheme
            applyIrlenScheme(irlenScheme);
            
            // Update active button
            updateIrlenButton(irlenScheme);
            
            // Add click events to Irlen buttons
            document.querySelectorAll('.irlen-btn-settings').forEach(btn => {
                btn.addEventListener('click', function() {
                    const scheme = this.getAttribute('data-scheme');
                    selectIrlenScheme(scheme);
                });
            });
        }

        function selectIrlenScheme(scheme) {
            applyIrlenScheme(scheme);
            localStorage.setItem('irlenScheme', scheme);
            updateIrlenButton(scheme);
            
            const schemeNames = {
                'default': 'Default Mickey Theme',
                'irlen-cream': 'Cream',
                'irlen-blue': 'Blue',
                'irlen-green': 'Green',
                'irlen-pink': 'Pink',
                'irlen-gray': 'Gray',
                'irlen-purple': 'Purple',
                'irlen-yellow': 'Yellow',
                'irlen-rose': 'Rose'
            };
            
            showSettingsNotification(`${schemeNames[scheme]} color scheme applied!`);
        }

        function applyIrlenScheme(scheme) {
            // Remove all Irlen classes
            document.body.classList.remove(
                'irlen-cream', 'irlen-blue', 'irlen-green', 'irlen-pink',
                'irlen-gray', 'irlen-purple', 'irlen-yellow', 'irlen-rose'
            );
            
            // Add selected scheme
            if (scheme !== 'default') {
                document.body.classList.add(scheme);
            }
        }

        function updateIrlenButton(activeScheme) {
            document.querySelectorAll('.irlen-btn-settings').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-scheme') === activeScheme) {
                    btn.classList.add('active');
                }
            });
        }

        function initializeSoundToggle() {
            const soundBtn = document.getElementById('toggle-sound');
            const soundEnabled = localStorage.getItem('soundEnabled') !== 'false';
            soundBtn.innerHTML = `<i class="fas fa-volume-${soundEnabled ? 'up' : 'mute'}"></i> Sound ${soundEnabled ? 'ON' : 'OFF'}`;
            
            soundBtn.addEventListener('click', function() {
                const newState = localStorage.getItem('soundEnabled') === 'false';
                localStorage.setItem('soundEnabled', newState);
                this.innerHTML = `<i class="fas fa-volume-${newState ? 'up' : 'mute'}"></i> Sound ${newState ? 'ON' : 'OFF'}`;
                showSettingsNotification(`Sound ${newState ? 'enabled' : 'disabled'}!`);
            });
        }

        // ============================================
        // NOTIFICATION FUNCTIONS
        // ============================================
        function showSettingsNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            notification.innerHTML = `
                <strong style="display: block; margin-bottom: 5px;">
                    ${type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️'} 
                    Settings Updated
                </strong>
                <div>${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // ============================================
        // OTHER SETTINGS FUNCTIONS
        // ============================================
        function changeStudentName() {
            const newName = prompt("Enter your new name:", localStorage.getItem('studentName') || '');
            if (newName && newName.trim()) {
                localStorage.setItem('studentName', newName.trim());
                showSettingsNotification(`Name changed to ${newName}!`, 'success');
            }
        }

        function exportProgress() {
            const progress = {
                studentName: localStorage.getItem('studentName'),
                studentGrade: localStorage.getItem('studentGrade'),
                points: localStorage.getItem('studentPoints') || 0,
                lastLogin: new Date().toISOString(),
                dyslexiaMode: localStorage.getItem('dyslexiaMode'),
                irlenScheme: localStorage.getItem('irlenScheme'),
                soundEnabled: localStorage.getItem('soundEnabled')
            };
            
            const dataStr = JSON.stringify(progress, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `mickey-progress-${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showSettingsNotification('Progress exported successfully!', 'success');
        }

        function resetProgress() {
            if (confirm("Are you sure you want to reset your progress? All your points and game progress will be lost.")) {
                localStorage.removeItem('studentPoints');
                localStorage.removeItem('gameProgress');
                showSettingsNotification('Progress reset successfully!', 'info');
            }
        }

        function logout() {
            if (confirm("This will clear ALL your data and return to the welcome screen. Are you sure?")) {
                localStorage.clear();
                window.location.href = 'welcome.html';
            }
        }
    </script>
</body>
</html>